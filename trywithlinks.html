<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Furniture Viewer</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
</head>

<body>
    <!-- <h1>Select an Item from below:</h1>
    <ul>
        <li><a href="#" onclick="openAR('Coffee Table')">Table</a></li>
        <li><a href="#" onclick="openAR('Metal Cabinet')">Cupboard</a></li>
    </ul> -->
    <h3>Try these buttons! v.4</h3>
    <button class="ar-start-button" title="Coffee Table" onclick="handleOpenAR(this)">Coffee Table</button>
    <button class="ar-start-button" title="Metal Cabinet" onclick="handleOpenAR(this)">Metal Cabinet</button>

    <model-viewer id="viewer" style="display: none;" ar ar-modes="webxr scene-viewer quick-look">
        <button slot="ar-button" id="ar-button" style="display: none;">View in your space</button>
    </model-viewer>

    <script>
        let hasTried = false;
        function handleOpenAR(button) {
            console.log("clicking...");
            const modelViewer = document.getElementsByTagName("model-viewer")[0];
            modelViewer.src = `./models/${button.title}.glb`;
            if (modelViewer.canActivateAR || !hasTried) {
                modelViewer.activateAR().then(value => {
                    console.log("tried to activate AR... and the result...")
                    console.log(value)
                });
                if (!hasTried) {
                    hasTried = true;
                    button.innerHTML = button.title + " (Loading...)";
                    setTimeout(() => button.click(), 500);
                }
            } else {
                const arButtons = document.getElementsByClassName("ar-start-button");
                for (element of arButtons) {
                    element.innerHTML = element.title + " (AR not supported)";
                }
            }

        }
    </script>
</body>

</html>